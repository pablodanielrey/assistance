<div  class="reporte">
  <div class="seccionSistema">
    <button mat-button class="btnVolverSeccion" (click)="volver()"><mat-icon>keyboard_arrow_left</mat-icon> volver</button>
     | Reporte Justificaciones
  </div>
  <mat-divider></mat-divider>
  <div class="contenidoPantalla">
    <div class="cabeceraReporte">
        <div class="contenedorListaDeUsuario">
            <mat-list class="listaUsuario">
              <mat-list-item class="itemLista">
                <img matListAvatar src="/assets/img/icono_usuario.jpg">
                <h3 matLine *ngIf="reporte && reporte.usuario"> {{reporte.usuario.nombre}} {{reporte.usuario.apellido}}</h3>
                <p matLine>
                  <span class="itemTextoSubtitulo" *ngIf="reporte && reporte.usuario  ">{{reporte.usuario.dni}}</span>
                </p>
              </mat-list-item>
            </mat-list>
        </div>
        <form (ngSubmit)='_generarReporte()'>
          <div class="contenedorSeleccionDeFechas">
            <mat-form-field class="seleccionFechaInicio">
                <mat-placeholder>Fecha Inicio</mat-placeholder>
              <input matInput [matDatepicker]="datePickerInicio" name='fecha_inicial' [(ngModel)]="fecha_inicial" required>
              <mat-datepicker-toggle matSuffix [for]="datePickerInicio"></mat-datepicker-toggle>
              <mat-datepicker #datePickerInicio></mat-datepicker>
            </mat-form-field>
            <mat-form-field class="seleccionFechaFin">
              <mat-placeholder>Fecha Fin</mat-placeholder>
              <input matInput [matDatepicker]="datePickerFin" name='fecha_final' [(ngModel)]="fecha_final" required>
              <mat-datepicker-toggle matSuffix [for]="datePickerFin"></mat-datepicker-toggle>
              <mat-datepicker #datePickerFin></mat-datepicker>
            </mat-form-field>
            <div class="contenedorBtnGenerar"><button mat-button class="btnGenerar" [disabled]="buscando" type='submit'>GENERAR REPORTE</button></div>
          </div>
        </form>
        <div class="contenedorBtnAcciones">
          <!-- <button mat-button class="btnAcciones" title="Imprimir"><i class="material-icons">print</i></button-->
          <button mat-button class="btnAcciones" (click)='exportarExcelAtoA()' title="Descargar"><i class="material-icons">archive</i></button>
          <!--button mat-button class="btnAcciones" title="Compartir"><i class="material-icons">share</i></button> -->
        </div>
    </div>
    <mat-progress-bar *ngIf="buscando" mode="indeterminate" value="10" class="preload"></mat-progress-bar>
    <mat-divider></mat-divider>
    <mat-tab-group>
            
      <mat-tab label='Reporte'>
        <div class="detalleReporte" *ngIf="!buscando">
          <div class="columna">
            <div class="titulo">Justificaciones Personales del {{reporte.fecha_inicial | date:'shortDate': '+0000'}} al {{reporte.fecha_final | date:'shortDate': '+0000'}}</div>
            <mat-divider></mat-divider>
            <div class="contenedorItemDetalles">
              <div class="itemDetalles" *ngFor='let j of reporte.suma_justificaciones'>
                <div>{{j.nombre +' ('+ j.codigo +')'}}:</div><div>{{j.cantidad}}</div>
              </div>
            </div>
          </div>
          <div class="columna">
            <div class="titulo">Justificaciones Generales del {{reporte.fecha_inicial | date:'shortDate': '+0000'}} al {{reporte.fecha_final | date:'shortDate': '+0000'}}</div>
            <mat-divider></mat-divider>
            <div class="contenedorItemDetalles">
              <div class="itemDetalles" *ngFor='let j of reporte.suma_justificaciones_generales'>
                <div>{{j.nombre +' ('+ j.codigo +')'}}:</div><div>{{j.cantidad}}</div>
              </div>
            </div>
          </div>
          <div class="columna" *ngIf="stock">
            <div class="titulo">Stock</div>
            <mat-divider></mat-divider>
            <div class="contenedorItemDetalles">
              <div class="itemDetalles" *ngFor='let s of stock'>
                <div>{{s.nombre}}:</div><div>{{s.cantidad}}</div>
              </div>
            </div>
          </div>
        </div>
      </mat-tab>


      <mat-tab label='Justificaciones'>
        <mat-table [dataSource]='fechasJustificadas | async' matSort>
          <ng-container matColumnDef='Inicio'>
            <mat-header-cell *matHeaderCellDef mat-sort-header> Inicio </mat-header-cell>
            <mat-cell *matCellDef='let fechaJustificada'> 
              {{fechaJustificada.fecha_inicio | date:'dd/MM/yyyy'}}
            </mat-cell>
          </ng-container>
          <ng-container matColumnDef='Fin'>
            <mat-header-cell *matHeaderCellDef mat-sort-header> Fin </mat-header-cell>
            <mat-cell *matCellDef='let fechaJustificada'> 
              {{fechaJustificada.fecha_fin | date:'dd/MM/yyyy'}}
            </mat-cell>
          </ng-container>
          <ng-container matColumnDef='Justificacion'>
            <mat-header-cell *matHeaderCellDef mat-sort-header> Justificacion </mat-header-cell>
            <mat-cell *matCellDef='let fechaJustificada'> 
              {{fechaJustificada.justificacion.nombre +' ('+ fechaJustificada.justificacion.codigo +')'}}
            </mat-cell>
          </ng-container>
          <ng-container matColumnDef='Notas'>
            <mat-header-cell *matHeaderCellDef mat-sort-header> Notas </mat-header-cell>
            <mat-cell *matCellDef='let fechaJustificada'>  
              {{fechaJustificada.notas || ""}}
            </mat-cell>
          </ng-container>
          <ng-container matColumnDef='Creada'>
              <mat-header-cell *matHeaderCellDef mat-sort-header> Creada </mat-header-cell>
              <mat-cell *matCellDef='let fechaJustificada'> 
                {{fechaJustificada.creado | date:'dd/MM/yyyy'}}
              </mat-cell>
          </ng-container>          
          <ng-container matColumnDef='Creador'>
            <mat-header-cell *matHeaderCellDef mat-sort-header> Creador </mat-header-cell>
            <mat-cell *matCellDef='let fechaJustificada'>  
              {{fechaJustificada.creador?.nombre || ""}}
              {{fechaJustificada.creador?.apellido || ""}}
            </mat-cell>
          </ng-container>
          <mat-header-row *matHeaderRowDef="columnasActivas"></mat-header-row>
          <mat-row *matRowDef="let row; columns: columnasActivas"></mat-row>
        </mat-table>
      </mat-tab>
        
      <mat-tab label='Justificaciones Eliminadas'>
        <mat-table [dataSource]='fechasEliminadas | async' matSort>
          <ng-container matColumnDef='Inicio'>
            <mat-header-cell *matHeaderCellDef mat-sort-header> Inicio </mat-header-cell>
            <mat-cell *matCellDef='let fechaJustificada'> 
              {{fechaJustificada.fecha_inicio | date:'dd/MM/yyyy'}}
            </mat-cell>
          </ng-container>
          <ng-container matColumnDef='Fin'>
            <mat-header-cell *matHeaderCellDef mat-sort-header> Fin </mat-header-cell>
            <mat-cell *matCellDef='let fechaJustificada'> 
              {{fechaJustificada.fecha_fin | date:'dd/MM/yyyy'}}
            </mat-cell>
          </ng-container>
          <ng-container matColumnDef='Justificacion'>
            <mat-header-cell *matHeaderCellDef mat-sort-header> Justificacion </mat-header-cell>
            <mat-cell *matCellDef='let fechaJustificada'> 
              {{fechaJustificada.justificacion.nombre +' ('+ fechaJustificada.justificacion.codigo +')'}}
            </mat-cell>
          </ng-container>
          <ng-container matColumnDef='Notas'>
            <mat-header-cell *matHeaderCellDef mat-sort-header> Notas </mat-header-cell>
            <mat-cell *matCellDef='let fechaJustificada'>  
              {{fechaJustificada.notas || ""}}
            </mat-cell>
          </ng-container>
          <ng-container matColumnDef='Creador'>
            <mat-header-cell *matHeaderCellDef mat-sort-header> Creador </mat-header-cell>
            <mat-cell *matCellDef='let fechaJustificada'>  
              {{fechaJustificada.creador?.nombre || ""}}
              {{fechaJustificada.creador?.apellido || ""}}
            </mat-cell>
          </ng-container>
          <ng-container matColumnDef='Eliminada'>
              <mat-header-cell *matHeaderCellDef mat-sort-header> Eliminada </mat-header-cell>
              <mat-cell *matCellDef='let fechaJustificada'> 
                {{fechaJustificada.eliminado | date:'dd/MM/yyyy'}}
              </mat-cell>
          </ng-container>          
          <ng-container matColumnDef='Eliminador'>
            <mat-header-cell *matHeaderCellDef mat-sort-header> Eliminador </mat-header-cell>
            <mat-cell *matCellDef='let fechaJustificada'>  
              {{fechaJustificada.eliminador?.nombre || ""}}
              {{fechaJustificada.eliminador?.apellido || ""}}
            </mat-cell>
          </ng-container>
          <mat-header-row *matHeaderRowDef="columnasEliminadas"></mat-header-row>
          <mat-row *matRowDef="let row; columns: columnasEliminadas"></mat-row>
        </mat-table>
      </mat-tab>


    </mat-tab-group>
  </div>
</div>